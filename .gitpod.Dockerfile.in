FROM restartus/src:latest
# Set environment for setup

# To be used in gitpod.io must be debian/ubuntu or alpine based
# Must also have a gitpod use
# With the jupyter/scipy-notebook base we end up with two users
# gitpod and joyvan
include(lib/lib.docker)

boilerplate()

include(lib/debug.docker)
include(restart/restart.docker)
include(nb/nb.docker)

# create the environment for the joyvan user which is used for notebooks
# note that conda does an init here but it is for the joyvan identity
create_conda_nb(nb)

# this creation is required for gitpod so we have the right gitpod
# https://github.com/gitpod-io/workspace-images/blob/master/full/Dockerfile
# '-l': see https://docs.docker.com/develop/develop-images/dockerfile_best-practices/#user
create_group(gitpod,33333)
create_user(gitpod,gitpod,33333)
# all the conda files owned by jupyter:users so add to the group
add_group(users,gitpod)
# which will use the source package

# conda init does not work in a bash script so set it here
# https://stackoverflow.com/questions/55507519/python-activate-conda-env-through-shell-script
#
     # source "$HOME/.bashrc" && \  # does not work
set_env_test(gitpod,conda)
set_env(gitpod,conda)

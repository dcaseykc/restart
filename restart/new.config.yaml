# Using anchors and aliases to limit duplication
# https://medium.com/@kinghuang/docker-compose-anchors-aliases-extensions-a1e4105d70bd
---
Parameter:
  version: 3.0
  backstop: [30, 60, 90, 120]

# Note each of these yaml files has an overall label, so you can copy and concat
# as needed
Dimension:
  # meta dimensionals for everything
  Geolocation (g):
    - King
    - Cupertino
  Geolocation Summary 1 (g1):
    - Washington
    - California
  Time (t):
    - August 2020
    - September 2020
  Time Summary (t1):
    - Summer 2020
    - Fall 2020
  Range (r):
    - Low
    - High

  Resource (n):
    - N95 Surgical
    - N95 Non-surgical
    - ASTM 3 Mask
    - ASTM 1-2 Mask
    - Non ASTM Mask
    - Face Shield
    - Gowns
    - Gloves
    - Shoe Covers
  Resource Summary (n1):
    - N95
    - Masks
    - Gloves
    - Other
  Resource Attribute (N):
    - Units
    - Volume
    - Area

  Population (p):
    - Healthcare Workers
    - First Responders
    - Other Workers
  # https://www.kff.org/coronavirus-covid-19/issue-brief/how-many-adults-are-at-risk-of-serious-illness-if-infected-with-coronavirus/
  Population Attribute (P):
    - Total
    - Higher Risk
  Population Summary Level 1 (p1):
    - Essential
    - Non-essential

  Demand Model (dx):
    - WA DOH
    - JHU
    - CDPH
  Demand for Resource (d):
    - WA0
    - WA1
    - WA2
    - WA3
    - WA4
    - WA5
    - WA6

  # Owner of the warehouse only hold the State for now
  Inventory (i):
    - State
  # Inventory attributes typically these are over different Resources
  # So iIR will be typical so for instance State Backstop i=State
  # might have N95 Surgical and ASTM 3 Masks in stock r=Resources
  # And then each will have inventory parameters I
  Inventory Attribute (I):
    - Initial
    - EOQ
    - Minimum
  Warehouse (w):
    - Tukwila
  Warehouse Attribute (W):
    - Area
    - Capacity

  Epi (e):
    - Reich
    - IHME
  Epi Attribute (E):
    - Cases
    - Hospitalizations
    - Deaths
  # all Reich Lab collected forecasts for now
  # cases, deaths by week, hosps by day
  # counties only have case data
  Mobility (m):
    - Apple
    - Google
  Mobility Attribute (M):
    - Driving
    - Walking
    - Transit
  Financial (f):
    - BoA
    - Fed
  Financial Attribute (F):
    - GDP
    - Unemployment

# Uses the dimensions above to create matrices
Model:
  population_rpP_tr:
    name: Total Population Attributes (rgp->P:tr)
    description: |
      There are p Populations by geolocation (g) with a
      range of estimates (r). Each population can have P attributes about them
      such as their degree of age, ethnicity, attitudes and awareness
      behaviors. The first attribute is the size of the sub-population. It
      models a real entity.

      The populations can be classes of people from OES by SOC, they
      could be organizations from OCEW by NAICS or they could be
      census units
    units: Total Entities
    kind: Real
    # The dimensions for each
    index:
      - Range (r)
      - Geography (g)
      - Population (p)
      - Population Attribute (P)
    array:
      # Range Lo
      -
        # Geography: CA
        -
          - [1310.2, 635]
          - [2010.2, 910]
          - [34659, 13159]
        # Geography: WA
        -
          - [335.2, 170]
          - [250.2, 91]
          - [7179.6, 2756]
      # Range High
      -
        -
          - [1410.2, 735]
          - [2010.2, 1010]
          - [35659, 14159]
        -
          - [435.2, 180]
          - [350.2, 101]
          - [7279.6, 2756]

  pop_demand_per_unit_map_rgpd_um:
    name: Per Unit Demand by Population for Resources (rgp->d:um)
    description: |
      For each p Populations falls into which protection
      category for the burn rate. That is what does each population p need
      of each resource r.  For example, 1.18 would mean you need 1.18 N95
      masks per day for a given population
    units: Per Person
    kind: Map
    index:
      - Range (r)
      - Geography (g)
      - Population (p)
      - Demand for Resource (d)
    array:
      # Range Lo
      -
        # Geography: CA
        -
          - [0.0, 0.0, 0.0, 0.0, 0.0, 0.5, 0.5]
          - [0.0, 0.0, 0.0, 0.0, 0.1, 0.7, 0.2]
          - [0.0, 0.4, 0.3, 0.2, 0.1, 0.0, 0.0]
        # Geography: WA
        -
          - [0.0, 0.0, 0.0, 0.0, 0.0, 0.5, 0.5]
          - [0.0, 0.0, 0.0, 0.0, 0.1, 0.7, 0.2]
          - [0.0, 0.5, 0.4, 0.1, 0.1, 0.0, 0.0]
      # Range Hi
      -
        -
          - [0.0, 0.0, 0.0, 0.0, 0.0, 0.5, 0.5]
          - [0.0, 0.0, 0.0, 0.0, 0.1, 0.7, 0.2]
          - [0.0, 0.4, 0.3, 0.2, 0.1, 0.0, 0.0]
        -
          - [0.0, 0.0, 0.0, 0.0, 0.0, 0.5, 0.5]
          - [0.0, 0.0, 0.0, 0.0, 0.1, 0.7, 0.2]
          - [0.0, 0.5, 0.4, 0.1, 0.1, 0.0, 0.0]

  pop_to_popsum_per_unit_dict_p_ul:
    name: Population to Summary Dictionary (p:ul)
    description: |
      Mapping of population (p) to all the summary levels in the model. These
      are chained. So we have maps to p->p1->p2->p3->...->pn.
    units: Per Person
    kind: List
    list:
      - pop_to_popsum1_per_unit_map_pp1_us
      - popsum1_to_popsum2_per_unit_map_p1p2_us

  pop_to_popsum1_per_unit_map_pp1_us:
    name: Population to Population Level 1 Summary Map (p->p1:us)
    description: |
      This maps every population p into any number of summary levels p1
      summarized by the p1 Level level used. In this model higher
      levels mean more protection by convention, but that isn't necessary.
      You can also a given population row spread across different levels
      so that for instance a percentage of a population could go into
      different rows.
    units: Per Person
    kind: Summary
    index:
      - Population (p)
      - Population Summary Level 1 (p1)
    array:
      - [1, 0]
      - [1, 0]
      - [0, 1]

  epi_rtgexeE_tr:
    name: Epi (exrtge->E:pr)
    description: |
      The disease maps p different populations against E
      attributes Shows the number of patients typically.
    units: Total People
    kind: Real
    index:
      - Epi Model (ex)
      - Range (r)
      - Geography (g)
      - Time (t)
      - Epi (e)
      - Epi Attribute (E)
    array:
      # IHME
      -
        # Range: Lo
        -
          # Geography: CA
          -
            # Time: August
            -
              - [900, 180, 20]
              - [9000, 1000, 100]
            # Time: September
            -
              - [1000, 200, 30]
              - [10000, 2000, 300]
          # Geography: WA
          -
            -
              - [50, 10, 15]
              - [500, 100, 150]
            -
              - [100, 200, 3]
              - [1000, 200, 30]
        # Range: Hi
        -
          # Geography: CA
          -
            # Time: August
            -
              - [1900, 1180, 120]
              - [19000, 11000, 1100]
            # Time: September
            -
              - [5000, 1000, 50]
              - [20000, 15000, 1500]
          # Geography: WA
          -
            -
              - [60, 20, 25]
              - [600, 200, 250]
            -
              - [200, 400, 6]
              - [2000, 400, 60]
      # MIT
      -
        # Range: Lo
        -
          # Geography: CA
          -
            # Time: August
            -
              - [1900, 280, 30]
              - [19000, 2000, 200]
            # Time: September
            -
              - [11000, 300, 40]
              - [20000, 3000, 400]
          # Geography: WA
          -
            -
              - [60, 60, 25]
              - [600, 200, 250]
            -
              - [200, 300, 4]
              - [2002, 300, 40]
        # Range: Hi
        -
          # Geography: CA
          -
            # Time: August
            -
              - [3900, 3180, 320]
              - [39000, 31000, 3100]
            # Time: September
            -
              - [6000, 2000, 70]
              - [40000, 35000, 3500]
          # Geography: WA
          -
            -
              - [80, 40, 25]
              - [600, 200, 250]
            -
              - [400, 600, 8]
              - [4000, 600, 80]

  financial_gtfF_pr:
    name: Financial (gtf->F:pr)
    description: |
      The Econometric attributes
    units: Percentage
    kind: Real
    index:
      - Geography (g)
      - Time (t)
      - Financial (f)
      - Financial Attribute (F)
    array:
      # Geography: CA
      -
        # Time: August
        -
          # GPD Index, Unemployment
          - [76, 0.10]
          - [76, 0.10]
        # Time: September
        -
          # GPD Index, Unemployment
          - [78, 0.11]
          - [78, 0.11]
      # Geography: WA
      -
        # Time: August
        -
          # GPD Index, Unemployment
          - [78, 0.12]
          - [78, 0.12]
        # Time: September
        -
          # GPD Index, Unemployment
          - [80, 0.13]
          - [80, 0.13]
      # Geography: CA
      -
        # Time: August
        -
          # GPD Index, Unemployment
          - [76, 0.10]
          - [76, 0.10]
        # Time: September
        -
          # GPD Index, Unemployment
          - [78, 0.11]
          - [78, 0.11]
      # Geography: WA
      -
        # Time: August
        -
          # BoA, Fed -> GPD Index, Unemployment
          - [78, 0.12]
          - [78, 0.12]
        # Time: September
        -
          # GPD Index, Unemployment
          - [80, 0.13]
          - [80, 0.13]

  mobility_gtmM_pr:
    name: Mobility (gtm->M:pr)
    description: |
      The mobility of statistics
    units: Percentage
    kind: Real
    index:
      - Geography (g)
      - Time (t)
      - Mobility (m)
      - Mobility Attribute (M)
    array:
      # Geography: CA
      -
        # Time: august
        -
          # apple, google -> drive, walk, transit
          - [0.8, 1.1, 0.6]
          - [0.9, 1.2, 0.7]
        # Time: September
        -
          - [0.8, 1.1, 0.6]
          - [0.9, 1.2, 0.7]
      # Geography: WA
      -
        # Time: august
        -
          # apple, google -> drive, walk, transit
          - [0.8, 1.1, 0.6]
          - [0.9, 1.2, 0.7]
        # Time: September
        -
          - [0.8, 1.1, 0.6]
          - [0.9, 1.2, 0.7]

  demand_per_unit_map_dxrdn_um:
    name: Demand Level for Resource by Demand Model Per Unit Map (dxrd->n:um)
    description: |
      Demand levels d for resources by different demand models for resources n.
      This is the consumption map that for each protection level shows which
      resources are burned.  Also now as the burn rates for PPE.
    units: Per Resource
    index:
      - Demand Model (dx)
      - Range (r)
      - Demand for Resource (d)
      - Resource (n)
    array:
      # Demand Model WA DOH
      -
        # Range Lo
        -
          - [0, 0, 0, 0, 0, 0, 0, 0, 0]
          # Resident or patient
          - [0, 0, 0, 0, 1, 0.02, 0.01, 0.5, 0]
          # Office worker
          - [0, 0, 0, 0, 2, 0.04, 0.02, 1, 0]
          # Customer facing worker (teacher)
          - [0, 0, 0, 1, 2, 0.08, 0.03, 2, 0.05]
          # Blue collar
          - [0, 0.05, 1, 0, 3, 0.12, 0.05, 4, 0.2]
          # First Responder (this is synthetic)
          - [0.5, 0.5, 1, 0.1, 0, 0.18, 1.5, 4, 0.4]
          # Lab and other likely contact
          - [0.1, 1, 2, 1, 0, 0.18, 1.5, 8, 0.4]
          # Healthcare with direct contact
          - [1.18, 0, 4.03, 1, 0.05, 0.27, 3.65, 12, 0.6]
        # WA DOH High
        -
          - [0, 0, 0, 0, 0, 0, 0, 0, 0]
          # Resident or patient
          - [0, 0, 0, 0, 1, 0.02, 0.01, 0.5, 0]
          # Office worker
          - [0, 0, 0, 0, 2, 0.04, 0.02, 1, 0]
          # Customer facing worker (teacher)
          - [0, 0, 0, 1, 2, 0.08, 0.03, 2, 0.05]
          # Blue collar
          - [0, 0.05, 1, 0, 3, 0.12, 0.05, 4, 0.2]
          # First Responder (this is synthetic)
          - [0.5, 0.5, 1, 0.1, 0, 0.18, 1.5, 4, 0.4]
          # Lab and other likely contact
          - [0.5, 0.7, 2, 1, 0, 0.18, 1.5, 8, 0.4]
          # Healthcare with direct contact
          - [2.18, 0, 3.03, 1, 0.05, 0.27, 3.65, 12, 0.6]
      # Demand Model CPPH
      -
        # Range Lo
        -
          - [0, 0, 0, 0, 0, 0, 0, 0, 0]
          # Resident or patient
          - [0, 0, 0, 0, 1, 0.02, 0.01, 0.5, 0]
          # Office worker
          - [0, 0, 0, 0, 2, 0.04, 0.02, 1, 0]
          # Customer facing worker (teacher)
          - [0, 0, 0, 1, 2, 0.08, 0.03, 2, 0.05]
          # Blue collar
          - [0, 0.05, 1, 0, 3, 0.12, 0.05, 4, 0.2]
          # First Responder (this is synthetic)
          - [0.5, 0.5, 1, 0.1, 0, 0.18, 1.5, 4, 0.4]
          # Lab and other likely contact
          - [0.1, 1, 2, 1, 0, 0.18, 1.5, 8, 0.4]
          # Healthcare with direct contact
          - [1.18, 0, 4.03, 1, 0.05, 0.27, 3.65, 12, 0.6]
        # Range High
        -
          - [0, 0, 0, 0, 0, 0, 0, 0, 0]
          # Resident or patient
          - [0, 0, 0, 0, 1, 0.02, 0.01, 0.5, 0]
          # Office worker
          - [0, 0, 0, 0, 2, 0.04, 0.02, 1, 0]
          # Customer facing worker (teacher)
          - [0, 0, 0, 1, 2, 0.08, 0.03, 2, 0.05]
          # Blue collar
          - [0, 0.05, 1, 0, 3, 0.12, 0.05, 4, 0.2]
          # First Responder (this is synthetic)
          - [0.5, 0.5, 1, 0.1, 0, 0.18, 1.5, 4, 0.4]
          # Lab and other likely contact
          - [0.5, 0.7, 2, 1, 0, 0.18, 1.5, 8, 0.4]
          # Healthcare with direct contact
          - [2.18, 0, 3.03, 1, 0.05, 0.27, 3.65, 12, 0.6]

  resource_rnN_ur:
    name: Resources Attributes (n->N:ur)
    description: |
        For all n Resources, these are the figures for each of the N Attribute
        of each resource.
    index:
      - Range (r)
      - Resource (n)
      - Resource Attribute (N)
    array:
      # Range Lo
      -
        - [1, 2, 0.7]
        - [1, 1.5, 0.8]
        - [1, 4, 0.9]
        - [1, 2, 3]
        - [1, 2.3, 0.7]
        - [1, 2, 1]
        - [1, 1, 0.5]
        - [1, 0.9, 0.7]
        - [1, 2, 2]
      # Range Hi
      -
        - [1, 2.1, 0.8]
        - [1, 1.6, 0.9]
        - [1, 4.1, 1.9]
        - [1, 2.1, 4]
        - [1, 2.4, 0.8]
        - [1, 2.1, 2]
        - [1, 1.1, 0.6]
        - [1, 0.95, 0.8]
        - [1, 2.1, 2.1]

  res_by_popsum1_cost_per_unit_rp1n_us:
    name: Cost of Resources by Population Summary Level 1 (rp1->n:us)
    description: |
      For each of p1 summary levels, get the per capita cost for each of n
      Resources.
    index:
      - Population Summary Level 1 (p1)
      - Resource (n)
    array:
      - [5.0, 4.0, 1.0, 0.60, 0.20, 2.50, 4.0, 0.20, 0.15]
      - [5.0, 4.0, 1.0, 0.60, 0.06, 1.50, 4.0, 0.20, 0.15]

  # TODO: will eventually merge init, eoq and min frames into this one
  inv_by_popsum1_param_iIp1n_tp:
    name: |
      Inventory by Attributes of Resources by
      Population Summary Level 1 Parameters (iIp1n:tr)
    description: |
      For each summarized population level l, this gives for every resource n
      initial inventory. The first plane is the initial inventory, the
      second plane is the economic order quantity and the initial inventory,
      third plane is the minimum safety stock. The units are total units we
      also keep an inventory expressed in periods separately for human readable
      reasons. This is not used yet as we do not have an easy way to slice
      apart this
    index:
      - Inventory (i)
      - Inventory Attribute (I)
      - Population Summary Level 1 (p1)
      - Resource (n)
    unit: Total Units
    kind: Real
    array:
      -
        -
          - [201, 300, 500, 700, 900, 1001, 2003, 2004, 2006]
          - [200, 400, 600, 800, 1000, 2001, 2002, 2005, 2007]
        -
          - [1, 2, 3, 4, 5, 6, 7, 8, 9]
          - [10, 20, 30, 40, 50, 60, 70, 80, 90]
        -
          - [101, 200, 300, 400, 500, 600, 700, 800, 900]
          - [102, 201, 301, 401, 501, 601, 701, 801, 901]

  inv_init_by_popsum1_total_rp1n_tc:
    name: |
      Total Initial Inventory of Resources by Population Summary Level 1
      (p1n_tc)
    description: |
      The Initial inventory in total units that should be held calculated for
      each Population Summary Level
    index:
      - Range (r)
      - Population Summary Level 1 (p1)
      - Resource (n)
    units: Total Units
    kind: Calculated
    array:
      -
        - [201, 300, 500, 700, 900, 1001, 2003, 2004, 2006]
        - [200, 400, 600, 800, 1000, 2001, 2002, 2005, 2007]

  inv_eoq_by_popsum1_total_rp1n_tc:
    name: |
      Economic Order Quantity for Inventory Minimum of Resources by Population
      Summary Level 1 (p1n_tc)
    description: |
      The minimum inventory in total units that should be held calculated for
      each Population Summary Level
    index:
      - Range (r)
      - Population Summary Level 1 (p1)
      - Resource (n)
    units: Total Units
    kind: Calculated
    array:
      -
        - [1, 2, 3, 4, 5, 6, 7, 8, 9]
        - [10, 20, 30, 40, 50, 60, 70, 80, 90]

  inv_min_by_popsum1_total_rp1n_tc:
    name: |
      Total Inventory Minimum of Resources by Population Summary Level 1
      (p1n_tc)
    description: |
      The minimum inventory in total units that should be held calculated for
      each Population Summary Level
    index:
      - Range (r)
      - Population Summary Level 1 (p1)
      - Resource (n)
    units: Total Units
    kind: Calculated
    array:
      -
        - [101, 200, 300, 400, 500, 600, 700, 800, 900]
        - [102, 201, 301, 401, 501, 601, 701, 801, 901]

  # These tables are generated from the inputs above so they are derived values
  # These are typically meta values that are derived from real objectcs
  # And maps that serve as input to processes
  demand_by_pop_per_person_pn_uc:
    name: Per Capita Demand by Population for Resources (pn:uc)
    description: |
      This is the per capita demand for a give population so this is not the per
      capita demand but for every n Resource for ever subpopulation p
    index:
      - Population (p)
      - Resource (n)
    units: Per Capita
    kind: Calculated

  demand_by_popsum1_per_person_p1n_uc:
    name: |
      Per Capita Demand for Resources by Population Summary Level 1 (p1n:uc)
    description: |
      This is the per capita demand for a set of n resources
      summarized by the l Summary Level used. It provides a view of demand
      aggregated by the summary level.
    units: Per Capita
    kind: Calculated
    index:
      - Population Summary Level 1 (p1)
      - Resource (n)

  demand_by_pop_total_pn_tc:
    name: Total Demand for Resources by Population (pn:tc)
    description: |
      This is the total demand for all p sub-Population for every resource n
    units: Total
    kind: Calculated
    index:
      - Population (p)
      - Resource (n)

  demand_by_popsum1_total_p1n_tc:
    name: Total Demand for Resources by Population Summary Level 1 (p1n:tc)
    description: |
      For all population summary levels p1, the total demand for a set
      of n resources
    units: Total
    kind: Calculated
    index:
      - Population Summary Level 1 (p1)
      - Resource (n)

  # TODO: As we start the conversion to range, inventory goes first
  # So this dupliction the p1n_tc version above
  demand_by_popsum1_total_rp1n_tc:
    name: |
      Total Demand for Resources by Population Summary Level 1 with Ranges
      (rp1n:tc)
    description: |
      For all populatio summary levels p1, the total demand for a set of
      resources with a range r of values
    units: Total
    kind: Calculated
    index:
      - Range (r)
      - Population Summary Level 1 (p1)
      - Resource (n)

  demand_by_popsum1_total_cost_p1n_xc:
    name: |
      Total Cost of Demand for Resources by Population Summary Level 1 (p1n:xc)
    description: |
      For all population summary levels (p1), the total cost for a set of
      n resources
    units: Total Cost
    kind: Calculated
    index:
      - Population Summary Level 1 (p1)
      - Resource (n)

  inv_by_popsum1_total_rp1n_tc:
    name: |
      Total Inventory of Resources by Population Summary Level 1 (rp1n_tc)
    description: |
      For all population summary levels, the total inventory in stock for all
      resources held in current inventory
    index:
      - Range (r)
      - Population Summary Level 1 (p1)
      - Resource (n)
    units: Total Units
    kind: Calculated

  inv_min_by_popsum1_in_periods_rp1n_pc:
    name: |
      Inventory Minimum of Resources by Population Summary Level 1 in Periods
      (p1n_tc)
    description: |
      The minimum inventory in days on hand of  units that should be held
      calculated for each Population Summary Level
    index:
      - Range (r)
      - Population Summary Level 1 (p1)
      - Resource (n)
    units: Period
    kind: Calculated

  inv_average_orders_by_popsum1_per_period_rp1n_uf:
    name: |
      Average Inventory Orders of Resource by Population Summary Level 1 for a
      Period (rp1n:uf)
    description: |
      Average Inventory needed for a given period (normally a day)
      for Resources by Population Summary Level 1. This is the flow of units
      needed every period.
    index:
      - Range (r)
      - Population Summary Level 1 (p1)
      - Resource (n)
    units: Units Per Period
    kind: Calculated

  inv_order_by_popsum1_total_rp1n_tc:
    name: |
      Inventory Order of Resources by Population Summary Level 1
    description: |
      The order for resources from population by Summary Level 1
      (rp1nL:tc)
    index:
      - Range (r)
      - Population Summary Level 1 (p1)
      - Resource (n)
    units: Period
    kind: Calculated


Paths:
  Root: ../data/ingestion
  OES: all_data_M_2019.xlsx
  CODE: list1_2020.xls
  POP: co-est2019-alldata.csv
  XLS: covid-surge-who.xlsx

Reich:
  Root: ../data/epidemiological/processed
  CUBE: reich.hdf5
  INDEX: reichindex.csv
